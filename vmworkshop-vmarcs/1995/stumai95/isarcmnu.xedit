/*********************************************************************/                                                                                                                                                                                        
/*                                                                   */                                                                                                                                                                                        
/* ISARCMNU XEDIT                                                    */                                                                                                                                                                                        
/*                                                                   */                                                                                                                                                                                        
/* Usage:  ISARCMNU is an XEDIT-based interactive input panel        */                                                                                                                                                                                        
/*         designed to be invoked from the ISARC EXEC.               */                                                                                                                                                                                        
/*                                                                   */                                                                                                                                                                                        
/* ISARCMNU is an interactive menu panel which present three (3)     */                                                                                                                                                                                        
/* selections to the customer:  view about information, query the    */                                                                                                                                                                                        
/* status of an account, request an account.  The results of the     */                                                                                                                                                                                        
/* selection is returned to ISARC EXEC, and the appropriate menu     */                                                                                                                                                                                        
/* item is called from ISARC EXEC.                                   */                                                                                                                                                                                        
/*                                                                   */                                                                                                                                                                                        
/* Exit Code Definitions:                                            */                                                                                                                                                                                        
/*   Exit Codes are not used.  Results returned via the program      */                                                                                                                                                                                        
/*   stack:                                                          */                                                                                                                                                                                        
/*     o Literal text "FINISHED" returned if the customer wanted     */                                                                                                                                                                                        
/*       to exit the account request mechanism.                      */                                                                                                                                                                                        
/*     o Literal text "UNAVAILABLE" returned if none of the profiles */                                                                                                                                                                                        
/*       for the menu items could be located.                        */                                                                                                                                                                                        
/*     o Literal text "QUERY" returned if the customer wanted to     */                                                                                                                                                                                        
/*       query the status of an account.                             */                                                                                                                                                                                        
/*     o Literal text "REQUEST" returned if the customer wanted to   */                                                                                                                                                                                        
/*       request an account.                                         */                                                                                                                                                                                        
/*     o Literal text "INFORMATION" returned if the customer wanted  */                                                                                                                                                                                        
/*       to view the about information for student accounts.         */                                                                                                                                                                                        
/*     o Literal text "MAINT" returned if ISARC was issued a maint   */                                                                                                                                                                                        
/*       request either via presence of the file $MAINT $DISABLE on  */                                                                                                                                                                                        
/*       VMSERV02 491 or via presence of all of the menu item        */                                                                                                                                                                                        
/*       $DISABLE files ($ABOUT, $QUERY, $REQUEST) on VMSERV02 491.  */                                                                                                                                                                                        
/*                                                                   */                                                                                                                                                                                        
/* Required Files:                                                   */                                                                                                                                                                                        
/*   ISARC    EXEC     (Calling program)                             */                                                                                                                                                                                        
/*   ISARCMNU ISARCHLP (Help for the top level menu)                 */                                                                                                                                                                                        
/*   ISARCREQ XEDIT    (Profile containing the account request panel)*/                                                                                                                                                                                        
/*   ISARCQRY XEDIT    (Profile containing the account query panel)  */                                                                                                                                                                                        
/*   ISARCINF XEDIT    (Profile containing the account info panel)   */                                                                                                                                                                                        
/*   ISARCQST XEDIT    (Profile containing query results display)    */                                                                                                                                                                                        
/*   ISARCRST XEDIT    (Profile containing services wait message)    */                                                                                                                                                                                        
/*   MESSAGE  TABLE    (Plain text file with mechanism messages)     */                                                                                                                                                                                        
/*   MESSAGE  MASTER   (Plain text overnight results file)           */                                                                                                                                                                                        
/*   INFORM   ISARCTXT (Plain text file with info on accounts)       */                                                                                                                                                                                        
/*   INSTRUCT ISARCTXT (Plain text file with request instructions)   */                                                                                                                                                                                        
/*                                                                   */                                                                                                                                                                                        
/* Mod Date  Init  Description                                       */                                                                                                                                                                                        
/* --------  ----  ------------------------------------------------- */                                                                                                                                                                                        
/* 07181994  PDL   Initial Development                               */                                                                                                                                                                                        
/* 07251994  PDL   Enabled code for ACCESSing the public data file   */                                                                                                                                                                                        
/*                 area.                                             */                                                                                                                                                                                        
/* 07261994  PDL   Added code to preserve the cursor placement after */                                                                                                                                                                                        
/*                 leaving the menus.  This works in conjunction     */                                                                                                                                                                                        
/*                 with STUDREQ EXEC via the program stack.          */                                                                                                                                                                                        
/* 07291994  PDL   Program/modules names changed.                    */                                                                                                                                                                                        
/* 07291994  PDL   Changed to new help display method.               */                                                                                                                                                                                        
/* 07291994  PDL   Changed PF1 key wording to "Help".                */                                                                                                                                                                                        
/* 07291994  PDL   Changed userid display to mod/level display.      */                                                                                                                                                                                        
/* 07291994  PDL   Changed description text to read "Place the       */                                                                                                                                                                                        
/*                 cursor on the desired menu item and press ENTER.".*/                                                                                                                                                                                        
/* 07291994  PDL   Changed screen title to display on two lines.     */                                                                                                                                                                                        
/* 07291994  PDL   Swapped display of menu items "Check..." and      */                                                                                                                                                                                        
/*                 "Request...".  "Request..." now displays before   */                                                                                                                                                                                        
/*                 "Check...".                                       */                                                                                                                                                                                        
/* 08011994  PDL   Added ability for administrator-level people      */                                                                                                                                                                                        
/*                 to at will disable menu items.                    */                                                                                                                                                                                        
/* 08011994  PDL   Changed all-filemode search on disable menu item  */                                                                                                                                                                                        
/*                 ability to a search for specifically the filemode */                                                                                                                                                                                        
/*                 accessing VMSERV02 491.                           */                                                                                                                                                                                        
/* 08011994  PDL   Various message text changes.                     */                                                                                                                                                                                        
/* 08021994  PDL   Added code to display critical conditions when    */                                                                                                                                                                                        
/*                 one or more menu items are not available.         */                                                                                                                                                                                        
/* 08031994  PDL   Added code to display "menu item(s) down..."      */                                                                                                                                                                                        
/*                 message when one or more menu items are not       */                                                                                                                                                                                        
/*                 available and the disable file(s) are not present.*/                                                                                                                                                                                        
/* 08031994  PDL   Added code to position cursor properly when       */                                                                                                                                                                                        
/*                 one or more menu items are disabled.              */                                                                                                                                                                                        
/* 08031994  PDL   Added code to detect whether or not the files     */                                                                                                                                                                                        
/*                 INSTRUCT ISARCTXT and ISARCINS XEDIT are present  */                                                                                                                                                                                        
/*                 for the request menu item.                        */                                                                                                                                                                                        
/* 08031994  PDL   Added code to make disabling/maint requests more  */                                                                                                                                                                                        
/*                 robust.  Resulted in addition of exit code        */                                                                                                                                                                                        
/*                 "MAINT".                                          */                                                                                                                                                                                        
/* 08041994  PDL   Added code to make sure ISARCHLP exists before    */                                                                                                                                                                                        
/*                 invoking the help display module.                 */                                                                                                                                                                                        
/* 08051994  PDL   Added fix to cursor positioning code.  Cursor not */                                                                                                                                                                                        
/*                 properly positioned under case where last item    */                                                                                                                                                                                        
/*                 is made not available and the first item was      */                                                                                                                                                                                        
/*                 already not available.                            */                                                                                                                                                                                        
/* 08111994  PDL   Added message change.  When "Z" accounts are      */                                                                                                                                                                                        
/*                 attempting to access ISARC, the message displayed */                                                                                                                                                                                        
/*                 will not be "there is a problem, contact the      */                                                                                                                                                                                        
/*                 HelpDesk".  Instead, it will state that requesting*/                                                                                                                                                                                        
/*                 accounts and checking the status of accounts are  */                                                                                                                                                                                        
/*                 only available from ULINFO from the main UofL     */                                                                                                                                                                                        
/*                 logo screen.  Otherwise, the menu will come up,   */                                                                                                                                                                                        
/*                 but the "check" and "request" items will be       */                                                                                                                                                                                        
/*                 unavailable.                                      */                                                                                                                                                                                        
/* 08121994  PDL   Modified where ISARCMNU looks for the disabler    */                                                                                                                                                                                        
/*                 files.  ISARCMNU will now look on 319-P for these */                                                                                                                                                                                        
/*                 files instead of VMSERV02 491.  This was done so  */                                                                                                                                                                                        
/*                 that "Z" accounts will also see the disabler files*/                                                                                                                                                                                        
/*                 as needed.                                        */                                                                                                                                                                                        
/* 09011994  PDL   Modified presentation method of the three menu    */                                                                                                                                                                                        
/*                 choices.  The cursor is now placed directly on    */                                                                                                                                                                                        
/*                 the menu items instead of beside the menu item.   */                                                                                                                                                                                        
/* 09061994  PDL   Modified procedure "check_for_presence_of_files". */                                                                                                                                                                                        
/*                 Code was added to call function                   */                                                                                                                                                                                        
/*                 "DetermineCodeMode" to find at which filemode the */                                                                                                                                                                                        
/*                 ISARC code and files are located.  The disabler   */                                                                                                                                                                                        
/*                 files ($MAINT $DISABLE, $ABOUT $DISABLE, $QUERY   */                                                                                                                                                                                        
/*                 $DISABLE, and $REQUEST $DISABLE) will be looked   */                                                                                                                                                                                        
/*                 for at the filemode determined by                 */                                                                                                                                                                                        
/*                 "DetermineCodeMode".                              */                                                                                                                                                                                        
/*                                                                   */                                                                                                                                                                                        
/*********************************************************************/                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
trace off                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
level="123"                                                                                                                                                                                                                                                    
master_loc="VMSYS:VMSERV01.ISARC.PUBLIC_ACCESS"                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
/* CODE DISABLED PER 07261994 MODIFICATION                   */                                                                                                                                                                                                
/* Make sure we have no extraneous information on the stack. */                                                                                                                                                                                                
/* "DESBUF"                                                  */                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
/* Retrieve the last line and column that the cursor was on. */                                                                                                                                                                                                
parse pull lastline                                                                                                                                                                                                                                            
parse pull lastcol                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
address command                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
/* Make sure that the menu item profiles exist. */                                                                                                                                                                                                             
freemode=""                                                                                                                                                                                                                                                    
first_request_for_check="YES"                                                                                                                                                                                                                                  
call check_for_presence_of_files                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
if display_no_items = "YES" then do                                                                                                                                                                                                                            
  queue "QQUIT"                                                                                                                                                                                                                                                
  queue value_to_return                                                                                                                                                                                                                                        
  queue "0"                                                                                                                                                                                                                                                    
  queue "0"                                                                                                                                                                                                                                                    
  exit                                                                                                                                                                                                                                                         
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
call position_cursor                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
/* Main part of ISARCMNU.  Call routines from here and exit out. */                                                                                                                                                                                            
call prepare_full_screen_environment                                                                                                                                                                                                                           
call initialize_variables                                                                                                                                                                                                                                      
call process_input                                                                                                                                                                                                                                             
address xedit "QQUIT"                                                                                                                                                                                                                                          
exit                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
/****************************************************************/                                                                                                                                                                                             
/* Input panel processing routine.  This routine issues a XEDIT */                                                                                                                                                                                             
/* screen READ and parses that information.                     */                                                                                                                                                                                             
/****************************************************************/                                                                                                                                                                                             
process_input:                                                                                                                                                                                                                                                 
/* We do not actually need to specify that we loop once, but    */                                                                                                                                                                                             
/* this will give the loop a name in case we must LEAVE it.     */                                                                                                                                                                                             
do loop = 1                                                                                                                                                                                                                                                    
  /* First, let us display the screen */                                                                                                                                                                                                                       
  call display_screen                                                                                                                                                                                                                                          
  address xedit "READ NOCHANGE NUMBER TAG"                                                                                                                                                                                                                     
  call check_for_presence_of_files                                                                                                                                                                                                                             
  call position_cursor                                                                                                                                                                                                                                         
  if display_no_items = "YES" then do                                                                                                                                                                                                                          
    do queued()                                                                                                                                                                                                                                                
      parse pull throwaway                                                                                                                                                                                                                                     
    end                                                                                                                                                                                                                                                        
    queue "QQUIT"                                                                                                                                                                                                                                              
    queue value_to_return                                                                                                                                                                                                                                      
    queue "0"                                                                                                                                                                                                                                                  
    queue "0"                                                                                                                                                                                                                                                  
    exit                                                                                                                                                                                                                                                       
  end                                                                                                                                                                                                                                                          
  /* Now let us process the information returned from the XEDIT READ */                                                                                                                                                                                        
  do queued()                                                                                                                                                                                                                                                  
    parse pull key line col text                                                                                                                                                                                                                               
    /* Prevent escapes from being acted upon */                                                                                                                                                                                                                
    text=translate(text," ","%")                                                                                                                                                                                                                               
    select                                                                                                                                                                                                                                                     
      when key = "PFK" then select                                                                                                                                                                                                                             
        when (line = 1)  | (line = 9)  |,                                                                                                                                                                                                                      
             (line = 13) | (line = 21) then do                                                                                                                                                                                                                 
          "PIPE CMS STATE ISARCMNU ISARCHLP * | HOLE"                                                                                                                                                                                                          
          retcode=RC                                                                                                                                                                                                                                           
          "PIPE CMS STATE ISARCHLP XEDIT * | HOLE"                                                                                                                                                                                                             
          if retcode=0 then retcode=RC                                                                                                                                                                                                                         
          if retcode ^= 0 then                                                                                                                                                                                                                                 
            message = "ERROR MNU001: Help for this screen (ISARCMNU)",                                                                                                                                                                                         
                      "is currently not available. Please report this",                                                                                                                                                                                        
                      "message to the HelpDesk at 502/852-7797."                                                                                                                                                                                               
          else                                                                                                                                                                                                                                                 
            address cms "XEDIT ISARCMNU ISARCHLP * (PROFILE",                                                                                                                                                                                                  
                        "ISARCHLP NOLOCK)"                                                                                                                                                                                                                     
        end                                                                                                                                                                                                                                                    
        when (line = 3)  | (line = 12) |,                                                                                                                                                                                                                      
             (line = 15) | (line = 24) then do                                                                                                                                                                                                                 
          queue "FINISHED"                                                                                                                                                                                                                                     
          leave loop                                                                                                                                                                                                                                           
        end                                                                                                                                                                                                                                                    
        otherwise message = "You have pressed an invalid PF key.  Valid",                                                                                                                                                                                      
                            "PF keys are shown below."                                                                                                                                                                                                         
      end                                                                                                                                                                                                                                                      
      when key = "ETK" then do                                                                                                                                                                                                                                 
        call process_selection                                                                                                                                                                                                                                 
        if queue_line_info = "YES" then                                                                                                                                                                                                                        
          leave loop                                                                                                                                                                                                                                           
      end                                                                                                                                                                                                                                                      
      otherwise nop                                                                                                                                                                                                                                            
    end                                                                                                                                                                                                                                                        
  end                                                                                                                                                                                                                                                          
end                                                                                                                                                                                                                                                            
return                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
/****************************************************************/                                                                                                                                                                                             
/* This routine will process any selections made by determining */                                                                                                                                                                                             
/* what line and column the cursor was on and translate that    */                                                                                                                                                                                             
/* to the desired selection.                                    */                                                                                                                                                                                             
/****************************************************************/                                                                                                                                                                                             
process_selection:                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
address xedit "EXTRACT /CURSOR/"                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
selline=CURSOR.1                                                                                                                                                                                                                                               
selcol=CURSOR.2                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
"DESBUF" /* Discard any other changed lines */                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
queue_line_info="NO"                                                                                                                                                                                                                                           
select                                                                                                                                                                                                                                                         
  when (selline = 9) & (display_info_item = "YES") then do                                                                                                                                                                                                     
    queue "INFORMATION"                                                                                                                                                                                                                                        
    queue_line_info="YES"                                                                                                                                                                                                                                      
  end                                                                                                                                                                                                                                                          
  when (selline = 11) & (display_request_item = "YES") then do                                                                                                                                                                                                 
    queue "REQUEST"                                                                                                                                                                                                                                            
    queue_line_info="YES"                                                                                                                                                                                                                                      
  end                                                                                                                                                                                                                                                          
  when (selline = 13) & (display_query_item = "YES") then do                                                                                                                                                                                                   
    queue "QUERY"                                                                                                                                                                                                                                              
    queue_line_info="YES"                                                                                                                                                                                                                                      
  end                                                                                                                                                                                                                                                          
  otherwise nop                                                                                                                                                                                                                                                
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* Now send back the line and column the cursor was on.      */                                                                                                                                                                                                
/* This will preserve the cursor placement for the customer. */                                                                                                                                                                                                
if queue_line_info = "YES" then do                                                                                                                                                                                                                             
  queue selline                                                                                                                                                                                                                                                
  queue selcol                                                                                                                                                                                                                                                 
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
return                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
/**********************************************************************/                                                                                                                                                                                       
/* Set up the XEDIT screen for an input panel.  Un-RESERVE all lines, */                                                                                                                                                                                       
/* default all PF keys, enable/disable certain XEDIT features to make */                                                                                                                                                                                       
/* the screen conducive to an input panel.                            */                                                                                                                                                                                       
/**********************************************************************/                                                                                                                                                                                       
prepare_full_screen_environment:                                                                                                                                                                                                                               
address xedit "SET SCALE OFF"                                                                                                                                                                                                                                  
address xedit "SET PREFIX OFF"                                                                                                                                                                                                                                 
address xedit "SET TOFEOF OFF"                                                                                                                                                                                                                                 
address xedit "SET CTLCHAR % ESCAPE"                                                                                                                                                                                                                           
address xedit "SET CTLCHAR @ PROTECT   HIGH"                                                                                                                                                                                                                   
address xedit "SET CTLCHAR ! PROTECT   NOHIGH"                                                                                                                                                                                                                 
address xedit "SET CTLCHAR $ NOPROTECT HIGH"                                                                                                                                                                                                                   
address xedit "SET CTLCHAR  NOPROTECT NOHIGH"                                                                                                                                                                                                                 
address xedit "SET MSGLINE ON 21 2"                                                                                                                                                                                                                            
address xedit "SET CMDLINE OFF"                                                                                                                                                                                                                                
address xedit "SET MSGMODE ON"                                                                                                                                                                                                                                 
address xedit "SET LINEND OFF"                                                                                                                                                                                                                                 
address xedit "SET CASE MIXED"                                                                                                                                                                                                                                 
address xedit "VERIFY OFF 1 80"                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
do i = 1 to 24                                                                                                                                                                                                                                                 
  address xedit "SET PF"i "BEFORE EMSG ERROR MNU002: Internal failure.",                                                                                                                                                                                       
                "Exit immediately and report this message to   the",                                                                                                                                                                                           
                "HelpDesk at 502/852-7997."                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
address xedit "SET PF3  BEFORE QQUIT"                                                                                                                                                                                                                          
address xedit "SET PF12 BEFORE QQUIT"                                                                                                                                                                                                                          
address xedit "SET PF15 BEFORE QQUIT"                                                                                                                                                                                                                          
address xedit "SET PF24 BEFORE QQUIT"                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
address xedit "EXTRACT /RESERVED */"                                                                                                                                                                                                                           
do index=1 to RESERVED.0                                                                                                                                                                                                                                       
  parse var RESERVED.index linenum otherstuff                                                                                                                                                                                                                  
  address xedit "SET RESERVED" linenum "OFF"                                                                                                                                                                                                                   
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
return                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
/*************************************************************/                                                                                                                                                                                                
/* Initialize internal variables and default input fields to */                                                                                                                                                                                                
/* certain values if there is a need to do so.               */                                                                                                                                                                                                
/*************************************************************/                                                                                                                                                                                                
initialize_variables:                                                                                                                                                                                                                                          
selline=0                                                                                                                                                                                                                                                      
selcol=0                                                                                                                                                                                                                                                       
err_line=lastline                                                                                                                                                                                                                                              
err_col=lastcol                                                                                                                                                                                                                                                
return                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
/*******************************************************************/                                                                                                                                                                                          
/* Display the actual input screen for the customer.  Accomplished */                                                                                                                                                                                          
/* by reserving the lines via XEDIT and PROTECTing/NOPROTECTing    */                                                                                                                                                                                          
/* the appropriate areas.  Also contains the message parsing code  */                                                                                                                                                                                          
/* which formats the message (up to 2 lines) for proper display.   */                                                                                                                                                                                          
/*******************************************************************/                                                                                                                                                                                          
display_screen:                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
address xedit                                                                                                                                                                                                                                                  
"SET RESERVED 1 NOH %!ISARCMNU ("level")          ",                                                                                                                                                                                                           
                     "%@University of Louisville%!              ",                                                                                                                                                                                             
                     left(date(),11)                                                                                                                                                                                                                           
"SET RESERVED 2  NOH %!                        ",                                                                                                                                                                                                              
                     "%@Individual Student Account%!"                                                                                                                                                                                                          
"SET RESERVED 3  NOH %!                        ",                                                                                                                                                                                                              
                     "        %@Main Menu%!"                                                                                                                                                                                                                   
"SET RESERVED 6  NOH %@Place the cursor on the desired menu item",                                                                                                                                                                                             
                     "and press ENTER."                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
if display_info_item = "YES" then                                                                                                                                                                                                                              
  "SET RESERVED 9  NOH %!                  ",                                                                                                                                                                                                                  
                       "%About Individual Student Accounts%!"                                                                                                                                                                                                 
else                                                                                                                                                                                                                                                           
  "SET RESERVED 9  NOH %@   NOT AVAILABLE  ",                                                                                                                                                                                                                  
                       "%!About Individual Student Accounts"                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
if display_request_item = "YES" then                                                                                                                                                                                                                           
  "SET RESERVED 11 NOH %!                  ",                                                                                                                                                                                                                  
                       "%Request an Individual Student Account%!"                                                                                                                                                                                             
else                                                                                                                                                                                                                                                           
  "SET RESERVED 11 NOH %@   NOT AVAILABLE  ",                                                                                                                                                                                                                  
                       "%!Request an Individual Student Account"                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
if display_query_item = "YES" then                                                                                                                                                                                                                             
  "SET RESERVED 13 NOH %!                  ",                                                                                                                                                                                                                  
                       "%Check the Status of an Account Request%!"                                                                                                                                                                                            
else                                                                                                                                                                                                                                                           
  "SET RESERVED 13 NOH %@   NOT AVAILABLE  ",                                                                                                                                                                                                                  
                       "%!Check the Status of an Account Request"                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
"SET RESERVED -1 NOH %@PF1/PF9%! Help                ",                                                                                                                                                                                                        
                    "%@PF3/PF12%! Quit"                                                                                                                                                                                                                        
address command                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
if message ^= "" then do                                                                                                                                                                                                                                       
  if (correct_before_exec == 1) then do                                                                                                                                                                                                                        
    message = "UNABLE TO SUBMIT REQUEST:  "||message                                                                                                                                                                                                           
    correct_before_exec = 0                                                                                                                                                                                                                                    
  end                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
  /* Now format the message for proper display */                                                                                                                                                                                                              
  nextword=""                                                                                                                                                                                                                                                  
  msglines.0=1                                                                                                                                                                                                                                                 
  msgindex=msglines.0                                                                                                                                                                                                                                          
  do index=1 to 2                                                                                                                                                                                                                                              
    msglines.index=""                                                                                                                                                                                                                                          
  end                                                                                                                                                                                                                                                          
  do index=1 to words(message)                                                                                                                                                                                                                                 
    msgindex=msglines.0                                                                                                                                                                                                                                        
    nextword=word(message,index)                                                                                                                                                                                                                               
    /* If we can fit the next word into the line, then do so */                                                                                                                                                                                                
    if (length(msglines.msgindex)+length(nextword)) <= 78 then                                                                                                                                                                                                 
      if length(msglines.msgindex) = 0 then                                                                                                                                                                                                                    
        msglines.msgindex=nextword                                                                                                                                                                                                                             
      else                                                                                                                                                                                                                                                     
        msglines.msgindex=msglines.msgindex||" "||nextword                                                                                                                                                                                                     
    /* Otherwise, pad the rest of the current line, */                                                                                                                                                                                                         
    /* and start a new line.                        */                                                                                                                                                                                                         
    else do                                                                                                                                                                                                                                                    
      msglines.msgindex=left(msglines.msgindex,79)                                                                                                                                                                                                             
      msglines.0=msglines.0+1                                                                                                                                                                                                                                  
      msgindex=msglines.0                                                                                                                                                                                                                                      
      msglines.msgindex=nextword                                                                                                                                                                                                                               
    end                                                                                                                                                                                                                                                        
  end                                                                                                                                                                                                                                                          
  msgtodisplay=""                                                                                                                                                                                                                                              
  do index=1 to msglines.0                                                                                                                                                                                                                                     
    msgtodisplay=msgtodisplay||msglines.index                                                                                                                                                                                                                  
  end                                                                                                                                                                                                                                                          
  address xedit "EMSG" msgtodisplay                                                                                                                                                                                                                            
end                                                                                                                                                                                                                                                            
address xedit "CURSOR SCREEN" err_line err_col                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
return                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
/***********************************************************/                                                                                                                                                                                                  
/* This routine checks to see if the menu item profiles    */                                                                                                                                                                                                  
/* exist.  If an item does not exist, the appropriate      */                                                                                                                                                                                                  
/* no-display flag is set.  If none of the profiles exist, */                                                                                                                                                                                                  
/* then set the no-display-any flag to indicate a exit-out.*/                                                                                                                                                                                                  
/***********************************************************/                                                                                                                                                                                                  
check_for_presence_of_files:                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
display_info_item="YES"                                                                                                                                                                                                                                        
display_query_item="YES"                                                                                                                                                                                                                                       
display_request_item="YES"                                                                                                                                                                                                                                     
down_info_directed="NO"                                                                                                                                                                                                                                        
down_query_directed="NO"                                                                                                                                                                                                                                       
down_request_directed="NO"                                                                                                                                                                                                                                     
value_to_return=""                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
/* We must also re-access 319 P so that we can always get the */                                                                                                                                                                                               
/* refreshed copy of the directory for 319 P.                 */                                                                                                                                                                                               
address command "PIPE CMS ACCESS 319 P | HOLE"                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
/* 09061994 ADDITION: Added call to DetermineCodeMode for     */                                                                                                                                                                                               
/*                    finding the filemode at which ISARC code*/                                                                                                                                                                                               
/*                    and files are located.                  */                                                                                                                                                                                               
isarc_mode=DetermineCodeMode(master_loc)                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
/* First we must access the front-end "external" files that we need */                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
/* Try to access the file area with the MESSAGE TABLE and  */                                                                                                                                                                                                  
/* MESSAGE MASTER files.                                   */                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
address command "PIPE CMS QUERY ACCESSED | DROP FIRST | STEM SCAN491."                                                                                                                                                                                         
do scan_index= 1 to scan491.0                                                                                                                                                                                                                                  
  parse var scan491.scan_index fm491 . . addr491 .                                                                                                                                                                                                             
  fm491=strip(fm491)                                                                                                                                                                                                                                           
  addr491=strip(addr491)                                                                                                                                                                                                                                       
  if (addr491 = "491") then                                                                                                                                                                                                                                    
    address command "RELEASE" fm491                                                                                                                                                                                                                            
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
address command "GETFMADR"                                                                                                                                                                                                                                     
parse upper pull . freemode . check                                                                                                                                                                                                                            
if check ^= "" then do                                                                                                                                                                                                                                         
  display_query_item="NO"                                                                                                                                                                                                                                      
  display_request_item="NO"                                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
else do                                                                                                                                                                                                                                                        
  address command "PIPE CMS ACCESS 491" freemode "| HOLE"                                                                                                                                                                                                      
  if RC ^= 0 then do                                                                                                                                                                                                                                           
    display_query_item="NO"                                                                                                                                                                                                                                    
    display_request_item="NO"                                                                                                                                                                                                                                  
  end                                                                                                                                                                                                                                                          
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* Now check to see if the MESSAGE TABLE file exists */                                                                                                                                                                                                        
if (display_query_item="YES") | (display_request_item="YES") then do                                                                                                                                                                                           
  "PIPE CMS STATE MESSAGE TABLE * | HOLE"                                                                                                                                                                                                                      
  if RC ^= 0 then do                                                                                                                                                                                                                                           
    display_query_item="NO"                                                                                                                                                                                                                                    
    display_request_item="NO"                                                                                                                                                                                                                                  
  end                                                                                                                                                                                                                                                          
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* Now check to see if the MESSAGE MASTER file exists */                                                                                                                                                                                                       
if display_query_item="YES" then do                                                                                                                                                                                                                            
  "PIPE CMS STATE MESSAGE MASTER * | HOLE"                                                                                                                                                                                                                     
  if RC ^= 0 then                                                                                                                                                                                                                                              
    display_query_item="NO"                                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* Check for files needed for the about info item */                                                                                                                                                                                                           
if display_info_item="YES" then do                                                                                                                                                                                                                             
  "PIPE CMS STATE ISARCINF XEDIT * | HOLE"                                                                                                                                                                                                                     
  if RC ^= 0 then display_info_item="NO"                                                                                                                                                                                                                       
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* 09061994 MODIFICATION: Now looking at "isarc_mode" instead of "P" */                                                                                                                                                                                        
/* "PIPE CMS STATE $ABOUT $DISABLE P | HOLE"                         */                                                                                                                                                                                        
"PIPE CMS STATE $ABOUT $DISABLE" isarc_mode "| HOLE"                                                                                                                                                                                                           
if RC = 0 then do                                                                                                                                                                                                                                              
  display_info_item="NO"                                                                                                                                                                                                                                       
  down_info_directed="YES"                                                                                                                                                                                                                                     
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
if display_info_item="YES" then do                                                                                                                                                                                                                             
  "PIPE CMS STATE INFORM ISARCTXT * | HOLE"                                                                                                                                                                                                                    
  if RC ^= 0 then display_info_item="NO"                                                                                                                                                                                                                       
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* Check for additional files needed for the query status item */                                                                                                                                                                                              
if display_query_item="YES" then do                                                                                                                                                                                                                            
  "PIPE CMS STATE ISARCQRY XEDIT * | HOLE"                                                                                                                                                                                                                     
  if RC ^= 0 then display_query_item="NO"                                                                                                                                                                                                                      
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* 09061994 MODIFICATION: Now looking at "isarc_mode" instead of "P" */                                                                                                                                                                                        
/* "PIPE CMS STATE $QUERY $DISABLE P | HOLE"                         */                                                                                                                                                                                        
"PIPE CMS STATE $QUERY $DISABLE" isarc_mode "| HOLE"                                                                                                                                                                                                           
if RC = 0 then do                                                                                                                                                                                                                                              
  display_query_item="NO"                                                                                                                                                                                                                                      
  down_query_directed="YES"                                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
if display_query_item="YES" then do                                                                                                                                                                                                                            
  "PIPE CMS STATE ISARCQST XEDIT * | HOLE"                                                                                                                                                                                                                     
  if RC ^= 0 then display_query_item="NO"                                                                                                                                                                                                                      
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* Check for additional files needed for the request account item */                                                                                                                                                                                           
if display_request_item="YES" then do                                                                                                                                                                                                                          
  "PIPE CMS STATE ISARCREQ XEDIT * | HOLE"                                                                                                                                                                                                                     
  if RC ^= 0 then display_request_item="NO"                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
if display_request_item="YES" then do                                                                                                                                                                                                                          
  "PIPE CMS STATE INSTRUCT ISARCTXT * | HOLE"                                                                                                                                                                                                                  
  if RC ^= 0 then display_request_item="NO"                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
if display_request_item="YES" then do                                                                                                                                                                                                                          
  "PIPE CMS STATE ISARCINS XEDIT * | HOLE"                                                                                                                                                                                                                     
  if RC ^= 0 then display_request_item="NO"                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* 09061994 MODIFICATION: Now looking at "isarc_mode" instead of "P" */                                                                                                                                                                                        
/* "PIPE CMS STATE $REQUEST $DISABLE P | HOLE"                       */                                                                                                                                                                                        
"PIPE CMS STATE $REQUEST $DISABLE" isarc_mode "| HOLE"                                                                                                                                                                                                         
if RC = 0 then do                                                                                                                                                                                                                                              
  display_request_item="NO"                                                                                                                                                                                                                                    
  down_request_directed="YES"                                                                                                                                                                                                                                  
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
if display_request_item="YES" then do                                                                                                                                                                                                                          
  "PIPE CMS STATE ISARCRST XEDIT * | HOLE"                                                                                                                                                                                                                     
  if RC ^= 0 then display_request_item="NO"                                                                                                                                                                                                                    
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* Check to see if the account request service machine is up... */                                                                                                                                                                                             
if display_request_item="YES" then do                                                                                                                                                                                                                          
  "PIPE CP QUERY USER VMSERV01 | HOLE"                                                                                                                                                                                                                         
  if RC ^= 0 then                                                                                                                                                                                                                                              
    display_request_item="NO"                                                                                                                                                                                                                                  
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
if (display_info_item = "NO")    &,                                                                                                                                                                                                                            
   (display_query_item = "NO")   &,                                                                                                                                                                                                                            
   (display_request_item = "NO") then do                                                                                                                                                                                                                       
     display_no_items="YES"                                                                                                                                                                                                                                    
     value_to_return="UNAVAILABLE"                                                                                                                                                                                                                             
end                                                                                                                                                                                                                                                            
else display_no_items="NO"                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
/* Have we been directed to shutdown anyway? */                                                                                                                                                                                                                
if display_no_items="NO" then do                                                                                                                                                                                                                               
  /* 09061994 MODIFICATION: Now looking at "isarc_mode" instead of "P" */                                                                                                                                                                                      
  /* "PIPE CMS STATE $MAINT $DISABLE P | HOLE"                         */                                                                                                                                                                                      
  "PIPE CMS STATE $MAINT $DISABLE" isarc_mode "| HOLE"                                                                                                                                                                                                         
  if RC = 0 then do                                                                                                                                                                                                                                            
    display_no_items="YES"                                                                                                                                                                                                                                     
    value_to_return="MAINT"                                                                                                                                                                                                                                    
  end                                                                                                                                                                                                                                                          
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/* If directed to display no items, was it because all of the disables */                                                                                                                                                                                      
/* except the $MAINT disable was present?  If so, then make it a       */                                                                                                                                                                                      
/* $MAINT disable instead.                                             */                                                                                                                                                                                      
if (display_no_items="YES") & (down_info_directed="YES") &,                                                                                                                                                                                                    
   (down_query_directed="YES") & (down_request_directed="YES") then                                                                                                                                                                                            
     value_to_return="MAINT"                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
message=""                                                                                                                                                                                                                                                     
if (display_no_items = "NO") then do                                                                                                                                                                                                                           
  if ((display_info_item = "NO") & (down_info_directed = "NO")) |,                                                                                                                                                                                             
     ((display_query_item = "NO") & (down_query_directed = "NO")) |,                                                                                                                                                                                           
     ((display_request_item = "NO") & (down_request_directed = "NO"))                                                                                                                                                                                          
    then do                                                                                                                                                                                                                                                    
      if (substr(userid(),7,1) = "Z") then do                                                                                                                                                                                                                  
        message="To request an account or check the status of an",                                                                                                                                                                                             
                "account request, please access ULINFO from the main",                                                                                                                                                                                         
                "U of L logo screen."                                                                                                                                                                                                                          
      end                                                                                                                                                                                                                                                      
      else do                                                                                                                                                                                                                                                  
        message="ERROR MNU003: One or more menu items are not",                                                                                                                                                                                                
                "available. Please report this message to the",                                                                                                                                                                                                
                "HelpDesk at 502/852-7997."                                                                                                                                                                                                                    
      end                                                                                                                                                                                                                                                      
  end                                                                                                                                                                                                                                                          
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
return                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
position_cursor:                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
if (lastline = 9)  & (display_info_item = "NO")    then lastline=11                                                                                                                                                                                            
if (lastline = 11) & (display_request_item = "NO") then lastline=13                                                                                                                                                                                            
if (lastline = 13) & (display_query_item = "NO")   then do                                                                                                                                                                                                     
  if (display_info_item="YES") then lastline=9                                                                                                                                                                                                                 
  if (display_request_item="YES") then lastline=11                                                                                                                                                                                                             
end                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
err_line=lastline                                                                                                                                                                                                                                              
err_col=lastcol                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
return                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
/**********************************************************************/                                                                                                                                                                                       
/**********************************************************************/                                                                                                                                                                                       
/**********************************************************************/                                                                                                                                                                                       
/* 09061994 ADDITION:  Added function DetermineCodeMode to find the   */                                                                                                                                                                                       
/*                     filemode where                                 */                                                                                                                                                                                       
/*                     VMSYS:VMSERV01.ISARC.PUBLIC_ACCESS is accessed.*/                                                                                                                                                                                       
/**********************************************************************/                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
DetermineCodeMode: procedure                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
  arg master_loc                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
  freemode="UNKNOWN"                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
  /* Get the mode definitions from CMS */                                                                                                                                                                                                                      
  address command "PIPE CMS QUERY ACCESSED",                                                                                                                                                                                                                   
                  "|    DROP FIRST",                                                                                                                                                                                                                           
                  "|    STEM MODES.",                                                                                                                                                                                                                          
                  "|    HOLE"                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
  /* Now let us search through the mode definitions and find the mode */                                                                                                                                                                                       
  /* at which VMSYS:VMSERV01.ISARC.PUBLIC_ACCESS has been accessed.   */                                                                                                                                                                                       
  do mode_index = 1 to modes.0                                                                                                                                                                                                                                 
    parse upper var modes.mode_index cmode . . . cloc                                                                                                                                                                                                          
    cmode=left(strip(cmode),1)                                                                                                                                                                                                                                 
    cloc=strip(cloc)                                                                                                                                                                                                                                           
    if (cloc = master_loc) then freemode=cmode                                                                                                                                                                                                                 
  end                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
return freemode                                                                                                                                                                                                                                                